<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>ğŸ° ì—´ë§¤ì˜ Gender Reveal Lotto</title>
<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Jua&family=Black+Han+Sans&display=swap" rel="stylesheet">
<style>
:root {
  --pink: #FFD1DC;
  --blue: #B5D8F7;
  --yellow: #FFF5BA;
  --mint: #B8F0D8;
  --lavender: #E8D5F5;
  --peach: #FFDAB9;
  --cream: #FFF9F0;
  --gold: #FFD700;
  --gold-dark: #DAA520;
  --text: #5A4A62;
  --text-light: #9B8BA3;
  --ticket-bg: linear-gradient(145deg, #FFFAF2 0%, #FFF5E8 100%);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

body {
  font-family: 'Gaegu', cursive;
  background: var(--cream);
  min-height: 100dvh;
  overflow-x: hidden;
  color: var(--text);
  touch-action: manipulation;
}

/* ===== ANIMATED BACKGROUND ===== */
.bg-layer {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 0;
  overflow: hidden;
}

.bg-layer::before {
  content: '';
  position: absolute;
  top: -50%; left: -50%;
  width: 200%; height: 200%;
  background:
    radial-gradient(ellipse at 25% 25%, rgba(255,209,220,0.35) 0%, transparent 50%),
    radial-gradient(ellipse at 75% 75%, rgba(181,216,247,0.35) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(232,213,245,0.25) 0%, transparent 55%);
  animation: bgDrift 25s ease-in-out infinite;
}

@keyframes bgDrift {
  0%, 100% { transform: translate(0, 0) rotate(0deg); }
  33% { transform: translate(3%, 2%) rotate(1deg); }
  66% { transform: translate(-2%, 3%) rotate(-1deg); }
}

.floating-items {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none; z-index: 0; overflow: hidden;
}

.float-item {
  position: absolute;
  opacity: 0.12;
  animation: floatUp linear infinite;
}

@keyframes floatUp {
  0% { transform: translateY(110dvh) rotate(0deg); }
  100% { transform: translateY(-60px) rotate(360deg); }
}

/* ===== CONTAINER ===== */
.container {
  position: relative;
  z-index: 1;
  max-width: 420px;
  margin: 0 auto;
  padding: 16px 16px 40px;
}

/* ===== START SCREEN ===== */
.screen { display: none; }
.screen.active { display: block; }

.start-screen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 92dvh;
  text-align: center;
}

.start-screen.active { display: flex; }

.logo-area {
  margin-bottom: 24px;
  animation: logoEntry 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes logoEntry {
  0% { transform: scale(0) rotate(-20deg); opacity: 0; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

.logo-emoji { font-size: 72px; margin-bottom: 8px; animation: logoPulse 3s ease-in-out infinite; }

@keyframes logoPulse {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.05) rotate(-3deg); }
  75% { transform: scale(1.05) rotate(3deg); }
}

.logo-title {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 36px;
  background: linear-gradient(135deg, var(--gold-dark), var(--gold), #FFC107);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: 3px;
  text-shadow: none;
  filter: drop-shadow(0 2px 4px rgba(218,165,32,0.3));
}

.logo-sub {
  font-family: 'Jua', sans-serif;
  font-size: 18px;
  color: var(--text-light);
  margin-top: 4px;
}

.baby-name-badge {
  display: inline-block;
  padding: 6px 24px;
  background: linear-gradient(135deg, var(--peach), var(--pink));
  border-radius: 50px;
  font-family: 'Jua', sans-serif;
  font-size: 16px;
  color: var(--text);
  margin: 16px 0 28px;
  box-shadow: 0 3px 12px rgba(255,209,220,0.4);
  animation: badgeBounce 2s ease-in-out infinite;
}

@keyframes badgeBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

.start-btn {
  width: 280px;
  padding: 18px 32px;
  border: none;
  border-radius: 60px;
  background: linear-gradient(135deg, var(--gold), #FFC107, var(--gold-dark));
  color: #5A3E00;
  font-family: 'Black Han Sans', sans-serif;
  font-size: 22px;
  letter-spacing: 2px;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(255,215,0,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
  transition: all 0.3s ease;
  animation: btnGlow 2s ease-in-out infinite;
}

@keyframes btnGlow {
  0%, 100% { box-shadow: 0 6px 24px rgba(255,215,0,0.4); }
  50% { box-shadow: 0 6px 32px rgba(255,215,0,0.7), 0 0 60px rgba(255,215,0,0.2); }
}

.start-btn:active { transform: scale(0.96); }

/* ===== GAME SCREEN ===== */
.game-header {
  text-align: center;
  margin-bottom: 16px;
}

.game-title {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 22px;
  background: linear-gradient(135deg, var(--gold-dark), var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.game-subtitle {
  font-family: 'Jua', sans-serif;
  font-size: 15px;
  color: var(--text-light);
  margin-top: 2px;
}

/* Lotto ticket */
.lotto-ticket {
  background: var(--ticket-bg);
  border-radius: 20px;
  padding: 20px 16px;
  box-shadow: 0 8px 40px rgba(0,0,0,0.08), 0 1px 0 rgba(255,255,255,0.8) inset;
  position: relative;
  border: 2px solid rgba(218,165,32,0.2);
}

.lotto-ticket::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 5px;
  background: linear-gradient(90deg, var(--gold), #FFC107, var(--gold-dark), var(--gold));
  border-radius: 20px 20px 0 0;
}

.ticket-header {
  text-align: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 2px dashed rgba(218,165,32,0.25);
}

.ticket-logo { font-size: 28px; }

.ticket-name {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 18px;
  color: var(--gold-dark);
  letter-spacing: 4px;
}

.ticket-sub {
  font-family: 'Jua', sans-serif;
  font-size: 13px;
  color: var(--text-light);
  margin-top: 2px;
}

/* ===== SCRATCH GRID ===== */
.scratch-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 16px;
}

.scratch-cell {
  position: relative;
  aspect-ratio: 1;
  border-radius: 14px;
  overflow: hidden;
  border: 2px solid rgba(218,165,32,0.15);
}

/* Revealed content under scratch */
.scratch-content {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px;
  border-radius: 12px;
}

.scratch-emoji { font-size: 30px; }
.scratch-label {
  font-family: 'Jua', sans-serif;
  font-size: 11px;
  text-align: center;
  line-height: 1.2;
  margin-top: 2px;
}

/* Canvas overlay for real scratching */
.scratch-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  border-radius: 12px;
  cursor: pointer;
  touch-action: none;
  z-index: 2;
}

.scratch-cell.locked .scratch-canvas {
  pointer-events: none;
}

.scratch-cell.locked::after {
  content: 'ğŸ”’';
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  z-index: 3;
  opacity: 0.7;
}

.scratch-cell.revealed .scratch-canvas { display: none; }

.scratch-cell.revealed .scratch-content {
  animation: cellReveal 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes cellReveal {
  0% { transform: scale(0.6); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

/* Progress */
.progress-area {
  text-align: center;
  padding-top: 14px;
  border-top: 2px dashed rgba(218,165,32,0.25);
}

.progress-bar-track {
  width: 100%;
  height: 10px;
  background: #F0E8F5;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-bar-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--gold), #FFC107);
  border-radius: 10px;
  transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.progress-text {
  font-family: 'Jua', sans-serif;
  font-size: 14px;
  color: var(--text-light);
}

/* Hint backgrounds */
.hint-bg-1 { background: linear-gradient(135deg, #FFF5BA, #FFECB3); }
.hint-bg-2 { background: linear-gradient(135deg, #B8F0D8, #A8E6CF); }
.hint-bg-3 { background: linear-gradient(135deg, #E8D5F5, #D5B8F0); }
.hint-bg-4 { background: linear-gradient(135deg, #FFDAB9, #FFD1A9); }
.hint-bg-5 { background: linear-gradient(135deg, #B5D8F7, #A5CDE8); }
.final-bg-boy { background: linear-gradient(135deg, #B5D8F7, #87CEEB); }
.final-bg-girl { background: linear-gradient(135deg, #FFD1DC, #FFB6C1); }
.hint-text-1 { color: #8B7B2A; }
.hint-text-2 { color: #3B7A5A; }
.hint-text-3 { color: #6B4A8A; }
.hint-text-4 { color: #8B6A3A; }
.hint-text-5 { color: #3A6A8B; }

/* ===== COUNTDOWN OVERLAY ===== */
.countdown-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  z-index: 50;
  align-items: center;
  justify-content: center;
}

.countdown-overlay.show { display: flex; }

.countdown-number {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 160px;
  color: var(--gold);
  text-shadow: 0 0 40px rgba(255,215,0,0.6), 0 0 80px rgba(255,215,0,0.3);
  animation: countPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.countdown-text {
  font-family: 'Jua', sans-serif;
  font-size: 24px;
  color: white;
  margin-top: -10px;
}

@keyframes countPop {
  0% { transform: scale(3); opacity: 0; }
  50% { transform: scale(0.9); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

/* ===== FINAL REVEAL ===== */
.reveal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 100;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.reveal-overlay.show { display: flex; }

.reveal-bg {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  transition: background 0.5s ease;
}

.reveal-bg.boy { background: linear-gradient(135deg, #D6EEFF 0%, #87CEEB 40%, #5BA3D9 100%); }
.reveal-bg.girl { background: linear-gradient(135deg, #FFE8EE 0%, #FFB6C1 40%, #E8789A 100%); }

.reveal-content {
  position: relative;
  z-index: 1;
  text-align: center;
  animation: revealEntry 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes revealEntry {
  0% { transform: scale(0) rotate(-10deg); opacity: 0; }
  60% { transform: scale(1.1) rotate(2deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

.reveal-jackpot {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 20px;
  color: var(--gold);
  letter-spacing: 6px;
  margin-bottom: 8px;
  text-shadow: 0 2px 8px rgba(0,0,0,0.2);
  animation: jackpotFlash 0.5s ease infinite alternate;
}

@keyframes jackpotFlash {
  0% { opacity: 0.8; }
  100% { opacity: 1; text-shadow: 0 0 20px rgba(255,215,0,0.6); }
}

.reveal-emoji {
  font-size: 90px;
  margin: 12px 0;
  animation: emojiDance 1.5s ease-in-out infinite;
}

@keyframes emojiDance {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.1) rotate(-5deg); }
  75% { transform: scale(1.1) rotate(5deg); }
}

.reveal-gender {
  font-family: 'Black Han Sans', sans-serif;
  font-size: 52px;
  letter-spacing: 4px;
  margin-bottom: 4px;
}

.reveal-gender.boy { color: #2A6DB5; }
.reveal-gender.girl { color: #C94A6E; }

.reveal-name {
  font-family: 'Jua', sans-serif;
  font-size: 22px;
  color: rgba(255,255,255,0.9);
  margin-bottom: 8px;
}

.reveal-congrats {
  font-size: 28px;
  margin-bottom: 24px;
  animation: congratsPulse 1s ease-in-out infinite;
}

@keyframes congratsPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.reset-btn {
  padding: 14px 40px;
  border: 2px solid rgba(255,255,255,0.5);
  border-radius: 50px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(4px);
  color: white;
  font-family: 'Jua', sans-serif;
  font-size: 17px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.reset-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.4); }

/* Confetti */
.confetti-container {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none;
  z-index: 101;
  overflow: hidden;
}

.confetti {
  position: absolute;
  top: -30px;
}

@keyframes confettiFall {
  0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
  80% { opacity: 1; }
  100% { transform: translateY(110dvh) rotate(1080deg) scale(0.4); opacity: 0; }
}

@keyframes confettiSway {
  0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
  25% { transform: translateY(28dvh) translateX(40px) rotate(270deg); }
  50% { transform: translateY(55dvh) translateX(-30px) rotate(540deg); opacity: 1; }
  75% { transform: translateY(83dvh) translateX(50px) rotate(810deg); }
  100% { transform: translateY(110dvh) translateX(0) rotate(1080deg); opacity: 0; }
}

@keyframes confettiBurst {
  0% { transform: translateY(0) scale(0); opacity: 0; }
  15% { transform: translateY(-30px) scale(1.5); opacity: 1; }
  100% { transform: translateY(110dvh) scale(0.3); opacity: 0; }
}

@keyframes sparkle {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.4; transform: scale(1.5); }
}

/* Admin panel */
.admin-panel {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(6px);
  z-index: 200;
  align-items: center;
  justify-content: center;
}

.admin-panel.show { display: flex; }

.admin-content {
  background: white;
  border-radius: 24px;
  padding: 28px 20px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.15);
  animation: adminPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  max-width: 320px;
  width: 88%;
}

@keyframes adminPop {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.gender-buttons {
  display: flex;
  gap: 14px;
  justify-content: center;
  margin: 16px 0;
}

.gender-btn {
  width: 120px;
  height: 120px;
  border: 3px solid transparent;
  border-radius: 20px;
  background: #F8F4FF;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-family: 'Jua', sans-serif;
  font-size: 16px;
  color: var(--text);
  transition: all 0.3s ease;
}

.gender-btn:active { transform: scale(0.95); }
.gender-btn .emoji { font-size: 40px; }

.gender-btn.selected-boy {
  border-color: var(--blue);
  background: linear-gradient(135deg, #E8F4FF, #B5D8F7);
  box-shadow: 0 4px 20px rgba(181,216,247,0.5);
}

.gender-btn.selected-girl {
  border-color: var(--pink);
  background: linear-gradient(135deg, #FFF0F3, #FFD1DC);
  box-shadow: 0 4px 20px rgba(255,209,220,0.5);
}

.admin-close-btn {
  margin-top: 16px;
  padding: 12px 36px;
  border: none;
  border-radius: 50px;
  background: linear-gradient(135deg, var(--mint), #A8E6CF);
  color: var(--text);
  font-family: 'Jua', sans-serif;
  font-size: 17px;
  cursor: pointer;
}

.admin-close-btn:active { transform: scale(0.95); }

/* Shake for locked cells */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-4px); }
  40% { transform: translateX(4px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
}

.scratch-cell.shake { animation: shake 0.4s ease; }

/* Screen transitions */
@keyframes fadeSlideIn {
  0% { opacity: 0; transform: translateY(24px); }
  100% { opacity: 1; transform: translateY(0); }
}

.game-screen.active { animation: fadeSlideIn 0.6s ease; }
</style>
</head>
<body>

<div class="bg-layer"></div>
<div class="floating-items" id="floatingItems"></div>

<div class="container">
  <!-- START SCREEN -->
  <div class="start-screen active" id="startScreen">
    <div class="logo-area">
      <div class="logo-emoji">ğŸ°</div>
      <div class="logo-title">BABY LOTTO</div>
      <div class="logo-sub">Gender Reveal</div>
    </div>
    <div class="baby-name-badge">ğŸŒ± íƒœëª…: ì—´ë§¤ ğŸŒ±</div>
    <button class="start-btn" onclick="startGame()">ğŸ« START!</button>
  </div>

  <!-- GAME SCREEN -->
  <div class="game-screen screen" id="gameScreen">
    <div class="game-header">
      <div class="game-title">ğŸ° BABY LOTTO ğŸ°</div>
      <div class="game-subtitle">ì†ê°€ë½ìœ¼ë¡œ ê¸ì–´ë³´ì„¸ìš”!</div>
    </div>

    <div class="lotto-ticket">
      <div class="ticket-header">
        <div class="ticket-logo">ğŸ«âœ¨</div>
        <div class="ticket-name">GENDER REVEAL</div>
        <div class="ticket-sub">ğŸŒ± ì—´ë§¤ì˜ í–‰ìš´ ë³µê¶Œ ğŸŒ±</div>
      </div>

      <div class="scratch-grid" id="scratchGrid"></div>

      <div class="progress-area">
        <div class="progress-bar-track">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">1ë²ˆë¶€í„° ìˆœì„œëŒ€ë¡œ ê¸ì–´ë³´ì„¸ìš”! ğŸ£</div>
      </div>
    </div>
  </div>
</div>

<!-- COUNTDOWN -->
<div class="countdown-overlay" id="countdownOverlay">
  <div style="text-align:center;">
    <div class="countdown-number" id="countdownNum"></div>
    <div class="countdown-text" id="countdownText"></div>
  </div>
</div>

<!-- FINAL REVEAL -->
<div class="reveal-overlay" id="revealOverlay">
  <div class="reveal-bg" id="revealBg"></div>
  <div class="reveal-content">
    <div class="reveal-jackpot">â˜… JACKPOT â˜…</div>
    <div class="reveal-emoji" id="revealEmoji"></div>
    <div class="reveal-gender" id="revealGender"></div>
    <div class="reveal-name">ìš°ë¦¬ ì—´ë§¤ëŠ”...</div>
    <div class="reveal-congrats">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</div>
    <button class="reset-btn" onclick="resetGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
  </div>
</div>

<!-- CONFETTI -->
<div class="confetti-container" id="confettiContainer"></div>

<!-- ADMIN PANEL -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-content">
    <div style="font-size:32px; margin-bottom:4px;">ğŸ”’</div>
    <div style="font-family:'Jua',sans-serif; font-size:20px; color:var(--text);">ì„±ë³„ ë¹„ë°€ ì„¤ì •</div>
    <p style="font-size:13px; color:var(--text-light); margin:6px 0 12px;">ê²Œì„ ì£¼ìµœìë§Œ ì„¤ì •í•˜ì„¸ìš”!</p>
    <div class="gender-buttons">
      <button class="gender-btn" id="btnBoy" onclick="selectGender('boy')">
        <span class="emoji">ğŸ‘¶ğŸ’™</span>Boy
      </button>
      <button class="gender-btn" id="btnGirl" onclick="selectGender('girl')">
        <span class="emoji">ğŸ‘¶ğŸ’—</span>Girl
      </button>
    </div>
    <button class="admin-close-btn" onclick="closeAdmin()">âœ“ ì„¤ì • ì™„ë£Œ</button>
  </div>
</div>

<script>
// ===== STATE =====
let selectedGender = null;
let currentStep = 0;
let isAnimating = false;
let secretTaps = 0;
let secretTimer = null;
const TOTAL = 6;
const SCRATCH_THRESHOLD = 0.45; // 45% scratched to reveal

// ===== HINT DATA =====
const hints = {
  boy: [
    { emoji: 'ğŸ‘£', text: 'ì‘ì€ ë°œìêµ­', bg: 'hint-bg-1', tc: 'hint-text-1' },
    { emoji: 'ğŸ§¸', text: 'ê³°ëŒì´ ì¹œêµ¬', bg: 'hint-bg-2', tc: 'hint-text-2' },
    { emoji: 'â­', text: 'ë°˜ì§ì´ëŠ” ë³„', bg: 'hint-bg-3', tc: 'hint-text-3' },
    { emoji: 'ğŸ¼', text: 'ì –ë³‘ ì¤€ë¹„!', bg: 'hint-bg-4', tc: 'hint-text-4' },
    { emoji: 'ğŸ§¢', text: 'ì‘ì€ ëª¨ì', bg: 'hint-bg-5', tc: 'hint-text-5' },
    { emoji: 'ğŸ‘¶ğŸ’™', text: "It's a BOY!", bg: 'final-bg-boy', tc: '' }
  ],
  girl: [
    { emoji: 'ğŸ‘£', text: 'ì‘ì€ ë°œìêµ­', bg: 'hint-bg-1', tc: 'hint-text-1' },
    { emoji: 'ğŸ§¸', text: 'ê³°ëŒì´ ì¹œêµ¬', bg: 'hint-bg-2', tc: 'hint-text-2' },
    { emoji: 'â­', text: 'ë°˜ì§ì´ëŠ” ë³„', bg: 'hint-bg-3', tc: 'hint-text-3' },
    { emoji: 'ğŸ¼', text: 'ì –ë³‘ ì¤€ë¹„!', bg: 'hint-bg-4', tc: 'hint-text-4' },
    { emoji: 'ğŸ€', text: 'ë¦¬ë³¸ í•˜ë‚˜', bg: 'hint-bg-5', tc: 'hint-text-5' },
    { emoji: 'ğŸ‘¶ğŸ’—', text: "It's a GIRL!", bg: 'final-bg-girl', tc: '' }
  ]
};

const progressMsgs = [
  '1ë²ˆë¶€í„° ìˆœì„œëŒ€ë¡œ ê¸ì–´ë³´ì„¸ìš”! ğŸ£',
  'ì²« ë²ˆì§¸ íŒíŠ¸ ë°œê²¬! ë‘ê·¼ë‘ê·¼ ğŸ’“',
  'ì ì  ê°€ê¹Œì›Œì§€ê³  ìˆì–´ìš”! ğŸ”',
  'ë²Œì¨ ë°˜! ê¸°ëŒ€ë˜ì£ ? âœ¨',
  'ê±°ì˜ ë‹¤ ì™”ì–´ìš”! ğŸ˜†',
  'ë§ˆì§€ë§‰ í•˜ë‚˜... ë‘êµ¬ë‘êµ¬! ğŸ¥',
  ''
];

// ===== SECRET ADMIN =====
document.addEventListener('DOMContentLoaded', () => {
  const logo = document.querySelector('.logo-emoji');
  if (logo) logo.addEventListener('click', () => {
    secretTaps++;
    clearTimeout(secretTimer);
    secretTimer = setTimeout(() => secretTaps = 0, 1500);
    if (secretTaps >= 5) {
      secretTaps = 0;
      document.getElementById('adminPanel').classList.add('show');
    }
  });
});

function selectGender(g) {
  selectedGender = g;
  document.getElementById('btnBoy').className = 'gender-btn' + (g === 'boy' ? ' selected-boy' : '');
  document.getElementById('btnGirl').className = 'gender-btn' + (g === 'girl' ? ' selected-girl' : '');
}

function closeAdmin() {
  document.getElementById('adminPanel').classList.remove('show');
}

// ===== START GAME =====
function startGame() {
  if (!selectedGender) selectedGender = 'boy';

  document.getElementById('startScreen').classList.remove('active');
  const gs = document.getElementById('gameScreen');
  gs.classList.add('active');

  buildGrid();
  updateProgress();
}

// ===== BUILD SCRATCH GRID =====
function buildGrid() {
  const grid = document.getElementById('scratchGrid');
  grid.innerHTML = '';
  const data = hints[selectedGender];

  for (let i = 0; i < TOTAL; i++) {
    const cell = document.createElement('div');
    cell.className = 'scratch-cell' + (i > 0 ? ' locked' : '');
    cell.dataset.idx = i;

    const h = data[i];
    const content = document.createElement('div');
    content.className = `scratch-content ${h.bg}`;
    content.innerHTML = `<div class="scratch-emoji">${h.emoji}</div><div class="scratch-label ${h.tc}">${h.text}</div>`;

    const canvas = document.createElement('canvas');
    canvas.className = 'scratch-canvas';

    cell.appendChild(content);
    cell.appendChild(canvas);
    grid.appendChild(cell);

    // Init canvas after it's in DOM
    requestAnimationFrame(() => initScratchCanvas(canvas, cell, i));
  }
}

// ===== REAL SCRATCH CANVAS =====
function initScratchCanvas(canvas, cell, idx) {
  const rect = cell.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  const w = rect.width;
  const h = rect.height;

  canvas.width = w * dpr;
  canvas.height = h * dpr;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';

  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  // Draw scratch cover
  const grad = ctx.createLinearGradient(0, 0, w, h);
  grad.addColorStop(0, '#C5B8D0');
  grad.addColorStop(0.3, '#B0A0BE');
  grad.addColorStop(0.5, '#9B8BA3');
  grad.addColorStop(0.7, '#B0A0BE');
  grad.addColorStop(1, '#C5B8D0');

  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, w, h);

  // Diagonal stripe pattern
  ctx.strokeStyle = 'rgba(255,255,255,0.08)';
  ctx.lineWidth = 1;
  for (let s = -h; s < w + h; s += 8) {
    ctx.beginPath();
    ctx.moveTo(s, 0);
    ctx.lineTo(s - h, h);
    ctx.stroke();
  }

  // Number text
  ctx.fillStyle = 'rgba(255,255,255,0.9)';
  ctx.font = `bold ${Math.floor(w * 0.35)}px 'Black Han Sans', sans-serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(idx + 1, w / 2, h / 2);

  // Scratching logic
  let scratching = false;

  function getPos(e) {
    const r = canvas.getBoundingClientRect();
    const touch = e.touches ? e.touches[0] : e;
    return { x: touch.clientX - r.left, y: touch.clientY - r.top };
  }

  function scratch(pos) {
    if (idx !== currentStep || isAnimating) return;
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, w * 0.12, 0, Math.PI * 2);
    ctx.fill();
    checkProgress();
  }

  function checkProgress() {
    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let transparent = 0;
    for (let p = 3; p < imgData.data.length; p += 4) {
      if (imgData.data[p] === 0) transparent++;
    }
    const ratio = transparent / (imgData.data.length / 4);

    if (ratio >= SCRATCH_THRESHOLD) {
      revealCell(cell, idx);
    }
  }

  canvas.addEventListener('mousedown', (e) => {
    if (idx !== currentStep) { cell.classList.add('shake'); setTimeout(() => cell.classList.remove('shake'), 400); return; }
    scratching = true;
    scratch(getPos(e));
  });
  canvas.addEventListener('mousemove', (e) => { if (scratching) scratch(getPos(e)); });
  canvas.addEventListener('mouseup', () => scratching = false);
  canvas.addEventListener('mouseleave', () => scratching = false);

  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (idx !== currentStep) { cell.classList.add('shake'); setTimeout(() => cell.classList.remove('shake'), 400); return; }
    scratching = true;
    scratch(getPos(e));
  }, { passive: false });
  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (scratching) scratch(getPos(e));
  }, { passive: false });
  canvas.addEventListener('touchend', () => scratching = false);
}

// ===== REVEAL CELL =====
function revealCell(cell, idx) {
  if (isAnimating) return;
  isAnimating = true;

  cell.classList.add('revealed');
  currentStep++;

  // Unlock next
  if (currentStep < TOTAL) {
    const next = document.querySelector(`.scratch-cell[data-idx="${currentStep}"]`);
    if (next) next.classList.remove('locked');
  }

  updateProgress();

  setTimeout(() => {
    isAnimating = false;
    // Last cell â†’ countdown â†’ reveal
    if (currentStep === TOTAL) {
      setTimeout(() => startCountdown(), 600);
    }
  }, 400);
}

// ===== PROGRESS =====
function updateProgress() {
  const pct = (currentStep / TOTAL) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = progressMsgs[currentStep];
}

// ===== COUNTDOWN =====
function startCountdown() {
  const overlay = document.getElementById('countdownOverlay');
  const numEl = document.getElementById('countdownNum');
  const textEl = document.getElementById('countdownText');
  overlay.classList.add('show');

  const steps = [
    { num: '3', text: 'ë‘êµ¬...' },
    { num: '2', text: 'ë‘êµ¬ë‘êµ¬...' },
    { num: '1', text: 'ì—´ë§¤ëŠ”?!' },
    { num: 'ğŸ‰', text: '' }
  ];

  let i = 0;
  function showStep() {
    if (i >= steps.length) {
      overlay.classList.remove('show');
      showFinalReveal();
      return;
    }
    numEl.textContent = steps[i].num;
    textEl.textContent = steps[i].text;
    numEl.style.animation = 'none';
    void numEl.offsetHeight;
    numEl.style.animation = 'countPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

    // Vibrate on each count
    if (navigator.vibrate) navigator.vibrate(80);

    i++;
    setTimeout(showStep, 1000);
  }
  showStep();
}

// ===== FINAL REVEAL =====
function showFinalReveal() {
  const overlay = document.getElementById('revealOverlay');
  const bg = document.getElementById('revealBg');
  const emoji = document.getElementById('revealEmoji');
  const gender = document.getElementById('revealGender');

  if (selectedGender === 'boy') {
    bg.className = 'reveal-bg boy';
    emoji.textContent = 'ğŸ‘¶ğŸ’™';
    gender.textContent = "It's a BOY!";
    gender.className = 'reveal-gender boy';
  } else {
    bg.className = 'reveal-bg girl';
    emoji.textContent = 'ğŸ‘¶ğŸ’—';
    gender.textContent = "It's a GIRL!";
    gender.className = 'reveal-gender girl';
  }

  overlay.classList.add('show');
  launchMegaConfetti();

  if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100, 50, 300]);
}

// ===== MEGA CONFETTI =====
function launchMegaConfetti() {
  const container = document.getElementById('confettiContainer');
  const boyC = ['#B5D8F7','#87CEEB','#4A90D9','#E8F4FF','#6BB3E0','#A5CDE8','#FFD700','#FFF5BA','#FFF'];
  const girlC = ['#FFD1DC','#FFB6C1','#E8789A','#FFF0F3','#FF9EBF','#F5A3C7','#FFD700','#FFF5BA','#FFF'];
  const colors = selectedGender === 'boy' ? boyC : girlC;
  const emojis = selectedGender === 'boy'
    ? ['ğŸ’™','â­','ğŸ§¸','ğŸ‘¶','âœ¨','ğŸ‰','ğŸ’«','ğŸŠ']
    : ['ğŸ’—','â­','ğŸ€','ğŸ‘¶','âœ¨','ğŸ‰','ğŸ’«','ğŸŠ'];

  // Wave 1: center burst
  for (let i = 0; i < 50; i++) setTimeout(() => makePiece(container, colors, 'burst'), i * 12);
  // Wave 2: rain
  for (let i = 0; i < 70; i++) setTimeout(() => makePiece(container, colors, 'rain'), 200 + i * 20);
  // Wave 3: sway
  for (let i = 0; i < 60; i++) setTimeout(() => makePiece(container, colors, 'sway'), 800 + i * 25);
  // Wave 4: emoji shower
  for (let i = 0; i < 30; i++) setTimeout(() => makeEmoji(container, emojis), 400 + i * 70);
  // Wave 5: sparkles
  for (let i = 0; i < 35; i++) setTimeout(() => makeSparkle(container, colors), 150 + i * 50);
  // Continuous rain
  const rain = setInterval(() => { for (let j = 0; j < 4; j++) makePiece(container, colors, 'rain'); }, 80);
  setTimeout(() => clearInterval(rain), 7000);
}

function makePiece(c, colors, type) {
  const el = document.createElement('div');
  el.className = 'confetti';
  const color = colors[Math.floor(Math.random() * colors.length)];
  const shapes = ['rect', 'streamer', 'circle'];
  const shape = shapes[Math.floor(Math.random() * shapes.length)];

  el.style.left = Math.random() * 100 + '%';

  if (shape === 'streamer') {
    el.style.width = (Math.random() * 4 + 5) + 'px';
    el.style.height = (Math.random() * 18 + 16) + 'px';
    el.style.borderRadius = '4px';
  } else if (shape === 'circle') {
    const s = Math.random() * 8 + 7;
    el.style.width = el.style.height = s + 'px';
    el.style.borderRadius = '50%';
    el.style.boxShadow = `0 0 ${Math.random()*6+2}px ${color}`;
  } else {
    el.style.width = (Math.random() * 10 + 6) + 'px';
    el.style.height = (Math.random() * 10 + 6) + 'px';
    el.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
  }
  el.style.background = color;

  const dur = Math.random() * 2 + 2;
  if (type === 'burst') {
    el.style.left = (35 + Math.random() * 30) + '%';
    el.style.top = '35%';
    el.style.animation = `confettiBurst ${dur + 1}s ease-out forwards`;
  } else if (type === 'sway') {
    el.style.animation = `confettiSway ${dur + 1.5}s ease-in-out forwards`;
  } else {
    el.style.animation = `confettiFall ${dur}s linear forwards`;
  }
  c.appendChild(el);
  setTimeout(() => el.remove(), 6000);
}

function makeEmoji(c, emojis) {
  const el = document.createElement('div');
  el.className = 'confetti';
  el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
  el.style.fontSize = (Math.random() * 16 + 14) + 'px';
  el.style.left = Math.random() * 100 + '%';
  el.style.animation = `confettiSway ${Math.random() * 2 + 3}s ease-in-out forwards`;
  c.appendChild(el);
  setTimeout(() => el.remove(), 6000);
}

function makeSparkle(c, colors) {
  const el = document.createElement('div');
  el.className = 'confetti';
  el.textContent = 'âœ¦';
  el.style.left = Math.random() * 100 + '%';
  el.style.top = Math.random() * 70 + '%';
  el.style.fontSize = (Math.random() * 14 + 10) + 'px';
  el.style.color = colors[Math.floor(Math.random() * colors.length)];
  el.style.textShadow = `0 0 10px ${el.style.color}`;
  el.style.animation = `sparkle ${Math.random()*0.8+0.4}s ease-in-out ${Math.random()*2}s 3, confettiFall ${Math.random()*3+3}s linear forwards`;
  c.appendChild(el);
  setTimeout(() => el.remove(), 7000);
}

// ===== RESET =====
function resetGame() {
  selectedGender = null;
  currentStep = 0;
  isAnimating = false;
  document.getElementById('revealOverlay').classList.remove('show');
  document.getElementById('confettiContainer').innerHTML = '';
  document.getElementById('gameScreen').classList.remove('active');
  document.getElementById('startScreen').classList.add('active');
  document.getElementById('btnBoy').className = 'gender-btn';
  document.getElementById('btnGirl').className = 'gender-btn';
}

// ===== FLOATING BG =====
(function createFloats() {
  const c = document.getElementById('floatingItems');
  const items = ['ğŸ¼','ğŸ§¸','â­','ğŸŒ™','ğŸ€','ğŸ­','ğŸŒˆ','â˜ï¸','ğŸ’«','ğŸ°','ğŸ«','ğŸŒ±'];
  for (let i = 0; i < 14; i++) {
    const el = document.createElement('div');
    el.className = 'float-item';
    el.textContent = items[Math.floor(Math.random() * items.length)];
    el.style.left = Math.random() * 100 + '%';
    el.style.fontSize = (Math.random() * 16 + 14) + 'px';
    el.style.animationDuration = (Math.random() * 18 + 14) + 's';
    el.style.animationDelay = (Math.random() * 22) + 's';
    c.appendChild(el);
  }
})();
</script>
</body>
</html>
